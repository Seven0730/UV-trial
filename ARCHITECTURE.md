# UV 展开算法库 - 架构图

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                      UV Unwrapping Library                   │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              Segmentation Layer (分割层)               │ │
│  │                                                         │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐  │ │
│  │  │ Edge Loop   │  │  Curvature  │  │   Texture    │  │ │
│  │  │ Detection   │  │   Analysis  │  │    Flow      │  │ │
│  │  └─────────────┘  └─────────────┘  └──────────────┘  │ │
│  │                                                         │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐  │ │
│  │  │  Gaussian   │  │   Detail    │  │  Symmetry    │  │ │
│  │  │  Curvature  │  │  Isolation  │  │   Cutting    │  │ │
│  │  └─────────────┘  └─────────────┘  └──────────────┘  │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │            Unwrapping Layer (展开层)                   │ │
│  │                                                         │ │
│  │  ┌──────────┐      ┌──────────┐      ┌──────────┐    │ │
│  │  │   LSCM   │      │   ABF    │      │   ARAP   │    │ │
│  │  │  (Fast)  │      │ (Quality)│      │ (Relax)  │    │ │
│  │  └──────────┘      └──────────┘      └──────────┘    │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │          Industrial Library Layer (工业库层)           │ │
│  │                                                         │ │
│  │     ┌──────────────┐           ┌──────────────┐       │ │
│  │     │   xatlas     │           │   UVAtlas    │       │ │
│  │     │  (Auto UV)   │           │ (GPU Accel.) │       │ │
│  │     └──────────────┘           └──────────────┘       │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              Utility Layer (工具层)                    │ │
│  │                                                         │ │
│  │  • UV Quality Analysis (质量分析)                      │ │
│  │  • Distortion Metrics (失真度量)                       │ │
│  │  • UV Packing (打包)                                   │ │
│  │  • Island Management (岛管理)                          │ │
│  └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ depends on
                              ▼
         ┌────────────────────────────────────────┐
         │       Core Libraries (核心库)          │
         │                                        │
         │  ┌──────────┐      ┌──────────┐      │
         │  │  libigl  │      │  Eigen   │      │
         │  │ (Mesh)   │      │ (Math)   │      │
         │  └──────────┘      └──────────┘      │
         └────────────────────────────────────────┘
```

## 数据流图

```
Input Mesh (V, F)
      │
      ├─────────────────┬─────────────────┬─────────────────┐
      │                 │                 │                 │
      ▼                 ▼                 ▼                 ▼
┌──────────┐      ┌──────────┐     ┌──────────┐     ┌──────────┐
│  Manual  │      │Curvature │     │ Texture  │     │ xatlas   │
│Segmentation     │Analysis  │     │  Flow    │     │  Auto    │
└────┬─────┘      └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                 │                 │                 │
     └────────┬────────┴────────┬────────┘                 │
              ▼                 ▼                          │
         UV Islands        UV Islands                      │
              │                 │                          │
              ├─────────────────┤                          │
              ▼                 ▼                          ▼
         ┌─────────┐       ┌─────────┐             Final UV (auto)
         │  LSCM   │       │   ABF   │
         └────┬────┘       └────┬────┘
              │                 │
              └────────┬────────┘
                       ▼
                  UV Coordinates
                       │
                       ▼
                  ┌─────────┐
                  │  Relax  │
                  └────┬────┘
                       ▼
                  ┌─────────┐
                  │  Pack   │
                  └────┬────┘
                       ▼
                  Final UV
                       │
                       ▼
                 Output (V, F, UV)
```

## 类关系图

```
┌─────────────────────────────────────────────────────────┐
│                    UVUnwrapping                          │
│                     (namespace)                          │
│                                                          │
│  ┌─────────────┐         ┌──────────────┐              │
│  │   Edge      │────────▶│  UVIsland    │              │
│  │  (struct)   │         │  (struct)    │              │
│  └─────────────┘         │              │              │
│                          │ • faces      │              │
│                          │ • boundary   │              │
│                          │ • centroid   │              │
│                          │ • area       │              │
│                          └──────────────┘              │
│                                                         │
│  Segmentation Functions:                               │
│  ┌────────────────────────────────────┐                │
│  │ • detectEdgeLoops()                │                │
│  │ • segmentByEdgeLoops()             │                │
│  │ • segmentByHighCurvature()         │                │
│  │ • segmentByGaussianCurvature()     │                │
│  │ • segmentByTextureFlow()           │                │
│  │ • segmentByDetailIsolation()       │                │
│  │ • segmentBySymmetry()              │                │
│  └────────────────────────────────────┘                │
│                                                         │
│  Unwrapping Functions:                                 │
│  ┌────────────────────────────────────┐                │
│  │ • unwrapLSCM()                     │                │
│  │ • unwrapABF()                      │                │
│  │ • unwrapABFPlusPlus()              │                │
│  │ • relaxUV()                        │                │
│  │ • packUVIslands()                  │                │
│  └────────────────────────────────────┘                │
│                                                         │
│  Quality Metrics:                                      │
│  ┌────────────────────────────────────┐                │
│  │ • computeUVDistortion()            │                │
│  │ • computeStretch()                 │                │
│  │ • computeGaussianCurvature()       │                │
│  │ • computePrincipalCurvatures()     │                │
│  └────────────────────────────────────┘                │
│                                                         │
│  Wrappers:                                             │
│  ┌──────────────────┐  ┌──────────────────┐           │
│  │ XAtlasWrapper    │  │ UVAtlasWrapper   │           │
│  │                  │  │                  │           │
│  │ • generate()     │  │ • generate()     │           │
│  │ • repack()       │  │ • generateWithIMT│           │
│  │                  │  │ • computeStretch()│           │
│  └──────────────────┘  └──────────────────┘           │
└─────────────────────────────────────────────────────────┘
```

## 算法决策树

```
                    开始：需要 UV 展开
                            │
                            ▼
                    是否需要精细控制？
                    ┌──────┴──────┐
                    │             │
                   是            否
                    │             │
                    ▼             ▼
            ┌────────────┐   使用 xatlas
            │ 手动分割   │   （全自动）
            └─────┬──────┘        │
                  │               │
        ┌─────────┼─────────┐     │
        │         │         │     │
        ▼         ▼         ▼     │
    机械零件   有机形体   纹理驱动  │
        │         │         │     │
        ▼         ▼         ▼     │
    边环分割  曲率分割  方向分割   │
        │         │         │     │
        └─────────┼─────────┘     │
                  │               │
                  ▼               │
          是否需要最高质量？      │
          ┌───────┴───────┐       │
          │               │       │
         是              否       │
          │               │       │
          ▼               ▼       │
    使用 ABF        使用 LSCM    │
    (慢但优)        (快速)       │
          │               │       │
          └───────┬───────┘       │
                  │               │
                  ▼               │
            应用松弛优化          │
                  │               │
                  └───────┬───────┘
                          │
                          ▼
                    UV 打包
                          │
                          ▼
                    质量检查
                          │
                          ▼
                      完成
```

## 性能对比图

```
算法速度对比（35K 面模型）:
  
xatlas   ████████░░░░░░░░░░░░░░░░  2.0s
LSCM     ██░░░░░░░░░░░░░░░░░░░░░░  0.5s
ABF      ████████████████████████  15s
─────────┬───────────┬───────────┬─────▶
         0          10          20  时间(秒)

质量对比（失真度量，越小越好）:

ABF      ████░░░░░░░░░░░░░░  0.08
xatlas   ██████░░░░░░░░░░░░  0.12
LSCM     ███████░░░░░░░░░░░  0.15
─────────┼─────────┼─────────┼─────▶
        0.0      0.1       0.2  失真值

内存使用对比（35K 面模型）:

LSCM     ████░░░░░░░░░░░░░░  ~50MB
ABF      ██████░░░░░░░░░░░░  ~80MB
xatlas   ████████░░░░░░░░░░  ~100MB
─────────┼─────────┼─────────┼─────▶
         0        50       100  内存(MB)
```

## 应用场景映射

```
┌──────────────────────────────────────────────────────┐
│              应用场景决策图                           │
└──────────────────────────────────────────────────────┘

游戏角色 (Game Character)
  ├─ 主角 (Hero) ────────────▶ 边环分割 + ABF
  ├─ NPC ───────────────────▶ 边环分割 + LSCM
  └─ 群众 (Crowd) ──────────▶ xatlas (批量)

机械模型 (Mechanical)
  ├─ 精密零件 ──────────────▶ 边环分割 + LSCM
  ├─ 重复部件 ──────────────▶ 镜像切割
  └─ 模块化场景 ────────────▶ 纹理方向切割

有机形体 (Organic)
  ├─ 人物头部 ──────────────▶ 高斯曲率 + ABF
  ├─ 动物/怪物 ─────────────▶ 高曲率切线 + LSCM
  └─ 植物 ──────────────────▶ xatlas

建筑场景 (Architecture)
  ├─ 室内场景 ──────────────▶ 纹理方向 + LSCM
  ├─ 室外场景 ──────────────▶ xatlas
  └─ 模块化资产 ────────────▶ 镜像/重复切割

特效/VFX (Effects)
  ├─ 电影级资产 ────────────▶ 细节隔离 + ABF
  ├─ 实时特效 ──────────────▶ LSCM
  └─ 粒子贴图 ──────────────▶ xatlas
```

## 优化建议流程图

```
                  检查 UV 质量
                        │
                        ▼
              失真 > 0.2 或拉伸 > 2.0？
                    ┌───┴───┐
                   是       否
                    │        │
                    ▼        └────▶ 完成
        ┌──────────────────┐
        │  问题诊断         │
        └──────┬───────────┘
               │
    ┌──────────┼──────────┐
    │          │          │
    ▼          ▼          ▼
拉伸过大    失真过大    UV 浪费
    │          │          │
    ▼          ▼          ▼
增加切缝    使用 ABF   重新打包
    │          │          │
    ▼          ▼          ▼
重新展开    添加松弛   调整间距
    │          │          │
    └──────────┼──────────┘
               │
               ▼
          重新评估质量
               │
               ▼
          是否满意？
          ┌────┴────┐
         是         否
          │          │
          ▼          └──▶ 调整参数
        完成               │
                          └──▶ 返回诊断
```

---

这些图表展示了：
1. 整体架构的层次关系
2. 数据在系统中的流动
3. 类和函数的组织结构
4. 算法选择的决策树
5. 性能和质量的权衡
6. 不同应用场景的最佳实践
7. UV 质量优化的迭代流程
