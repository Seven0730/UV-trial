# Heat Method 测地线实现总结

## 模块结构

| 文件 | 说明 |
|------|------|
| `include/uv_geodesic.h` | Heat Method 求解器 API：预处理、距离计算、路径追踪 |
| `src/heat_geodesic.cpp` | 算法实现：构建算子、稀疏分解、梯度归一化、泊松求解 |
| `examples/example_geodesic.cpp` | CLI：读取 OBJ、计算源→目标测地线、输出 JSON |
| `visualization/` | Three.js 查看器（`index.html`/`viewer.js`）读取 OBJ + 测地线 JSON，并用 TubeGeometry 渲染 |

## 算法流程

1. **预计算算子**  
   - `igl::cotmatrix` 生成正定拉普拉斯 `L`（取负）  
   - `igl::massmatrix` 构造质量矩阵 `M`  
   - `igl::grad` 提供离散梯度算子 `G`
2. **热扩散**  
   - 根据平均边长设置 `t`，求解 `(M + tL) u = M u₀`
3. **方向场归一化**  
   - `G u` 给出每个三角形的梯度，取反并单位化得到 `X`
4. **泊松求解**  
   - `igl::divergence` 计算 `∇·X`，求解 `(L + εM) φ = div`
5. **距离场与路径**  
   - 将 `φ` 平移为非负距离
   - `tracePath` 在邻接图上做贪心下降，返回 `GeodesicPath`

## 关键细节

- **时间步长**：`t = (mean_edge_length)^2`，并允许外部传入 `time_scale`
- **正则化**：泊松方程加 `ε=1e-8` 的质量项，避免零特征值
- **稳定性**：梯度长度 < 1e-12 时归零，路径追踪要求至少 `descent_epsilon` 的下降
- **多源支持**：`computeDistance` 接受任意数量的源点，内部对 `u₀` 做平均
- **输出**：距离场 + 顶点索引 + 世界坐标 polyline + 目标点距离

## 可视化建议

- 仓库提供 `visualization/index.html`，运行 `./scripts/serve_visualizer.sh` 后即可在浏览器中载入模型与 polyline
- 将 JSON polyline 读取到 Three.js，使用 `TubeGeometry` 构造细管
- 启用 `polygonOffset` 避免与网格表面 Z-fighting
- 可根据 `path.length` 显示数值或调色

## 后续扩展

1. **多目标批量查询**：在同一距离场上执行多个 `tracePath`
2. **曲面内插**：在每条边上加入额外采样点，保持与曲面更贴合
3. **WASM 导出**：示例使用 libigl，可继续编译到 WebAssembly 提供浏览器求解能力
